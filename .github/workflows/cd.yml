name: CD

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    # ============================================================================
    # ENVIRONMENT CONFIGURATION (Optional)
    # ============================================================================
    # Uncomment to use GitHub Environments for deployment protection rules.
    # You must create the environment in: Settings → Environments → New environment
    # Environments allow you to configure required reviewers and secrets.
    # ============================================================================
    # environment:
    #   name: production
    #   url: https://your-app.com

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24.x'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build for production
        run: npm run build -- --configuration production
        env:
          NODE_ENV: production

      - name: Run tests
        run: npm test -- --watch=false

    # ============================================================================
    # DEPLOYMENT CONFIGURATION
    # ============================================================================
    # This is a template project - uncomment and configure ONE of the deployment
    # options below based on your hosting platform.
    #
    # Important: Update the 'output_location' path if your build outputs to a
    # different directory. Check your angular.json for the correct outputPath.
    # ============================================================================

    # Option 1: Deploy to Azure Static Web Apps
    # ----------------------------------------------------------------------------
    # Prerequisites:
    #   1. Create an Azure Static Web App in Azure Portal
    #   2. Add secret: AZURE_STATIC_WEB_APPS_API_TOKEN (from Azure Portal)
    #   3. Update 'output_location' to match your build output directory
    # ----------------------------------------------------------------------------
    # - name: Deploy to Azure Static Web Apps
    #   if: success()
    #   uses: Azure/static-web-apps-deploy@v1
    #   with:
    #     azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }}
    #     repo_token: ${{ secrets.GITHUB_TOKEN }}
    #     action: "upload"
    #     app_location: "/"
    #     output_location: "dist/clean-front-template/browser"

    # Option 2: Deploy to GitHub Pages
    # ----------------------------------------------------------------------------
    # Prerequisites:
    #   1. Enable GitHub Pages in repository Settings → Pages
    #   2. Set source to "GitHub Actions"
    #   3. (Optional) Add CNAME for custom domain
    # ----------------------------------------------------------------------------
    # - name: Deploy to GitHub Pages
    #   if: success()
    #   uses: peaceiris/actions-gh-pages@v3
    #   with:
    #     github_token: ${{ secrets.GITHUB_TOKEN }}
    #     publish_dir: ./dist/clean-front-template/browser
    #     # Uncomment and set your custom domain:
    #     # cname: your-domain.com

    # Option 3: Deploy to Netlify
    # ----------------------------------------------------------------------------
    # Prerequisites:
    #   1. Create a Netlify account and site
    #   2. Add secrets:
    #      - NETLIFY_AUTH_TOKEN (from Netlify User Settings → Applications)
    #      - NETLIFY_SITE_ID (from Netlify Site Settings → General)
    # ----------------------------------------------------------------------------
    # - name: Deploy to Netlify
    #   if: success()
    #   uses: nwtgck/actions-netlify@v2
    #   with:
    #     publish-dir: './dist/clean-front-template/browser'
    #     production-branch: main
    #     github-token: ${{ secrets.GITHUB_TOKEN }}
    #     deploy-message: "Deploy from GitHub Actions"
    #   env:
    #     NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
    #     NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}

    # Option 4: Deploy to AWS S3 + CloudFront
    # ----------------------------------------------------------------------------
    # Prerequisites:
    #   1. Create S3 bucket configured for static website hosting
    #   2. Create CloudFront distribution pointing to S3 bucket
    #   3. Add secrets:
    #      - AWS_ACCESS_KEY_ID
    #      - AWS_SECRET_ACCESS_KEY
    #      - S3_BUCKET (bucket name)
    #      - CLOUDFRONT_DISTRIBUTION_ID
    # ----------------------------------------------------------------------------
    # - name: Configure AWS credentials
    #   if: success()
    #   uses: aws-actions/configure-aws-credentials@v4
    #   with:
    #     aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
    #     aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    #     aws-region: us-east-1
    #
    # - name: Deploy to S3 and invalidate CloudFront
    #   run: |
    #     aws s3 sync ./dist/clean-front-template/browser s3://${{ secrets.S3_BUCKET }} --delete
    #     aws cloudfront create-invalidation --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} --paths "/*"
